 \documentclass[11pt, letterpaper]{article}
\usepackage[legalpaper, margin=3 cm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[spanish]{babel}
\spanishdecimal{.}
%\usepackage{lmodern}
\usepackage{graphicx}
%\usepackage{wrapfig}
%\usepackage{rotating}
%\usepackage{subfig}
\usepackage{amsmath}
%\usepackage{textcomp}
\usepackage{amssymb}
\usepackage{hyperref}
%\usepackage{longtable}
%\usepackage{minted}
\usepackage{makecell}
\usepackage{lipsum}
\usepackage[spanish]{babel}
\usepackage[round]{natbib}

\title{\textsc{Bitácora experimental} \\
Experimentos con modelo básico de dinámica de opiniones
}  

\author{Ulises Jiménez Guerrero\\
	Alumno de la Maestría en Inteligencia Artificial \\ \\ \textbf{IIIA}
	Instituto de Investigaciones en Inteligencia Artificial \\
	Universidad Veracruzana \\ \emph{Campus Sur, Calle Paseo Lote II,
		Sección 2a, No 112} \\ \emph{Nuevo Xalapa, Xalapa, Ver., México 91097}
	\\ \\ zS24019399@estudiantes.uv.mx}

\date{\today}

\begin{document}
	\maketitle
	
\section{Objetivo}
	En este documento se describen los experimentos realizados sobre el modelo básico de dinámica de opiniones, juntos a los resultados obtenidos. El objetivo es lograr reproducir el cambio de opinión durante la elección presidencial en México llevada a cabo el 2 de junio de 2024. Para ello, se obtuvieron los resultados en la \href{https://prep2024.ine.mx/publicacion/nacional/presidencia/nacional/candidatura}{página web del PREP 2024}. La opinión pública e intención de voto se mide mediante las encuestas realizadas por el grupo GEA-ISA en tres cortes, disponibles en \href{https://repositoriodocumental.ine.mx/xmlui/handle/123456789/166950}{el repositorio del INE.}
	
\section{Materiales y métodos}
	El protocolo ODD del modelo base se encuentra anexado al final del presente documento, adaptado para su uso en el caso de estudio. La elección real vio la competición entre tres candidatos principales a la presidencia, representados por dos alianzas políticas y un partido independiente. Los datos originales se muestran en la tabla \ref{tab:datos_crudos}, registrando la evolución de la intención de voto a nivel nacional tomando tres cortes de tiempo y también se toma en cuenta los resultados de la elección. El instrumento utilizado fue creado por el grupo GEA-ISA, y toma en cuenta a 1070 entrevistados a nivel nacional con una serie de preguntas sobre su intención de voto y datos demográficos.
	
\begin{table}[h!]
	\centering
	\begin{tabular}{|c|c|c|c|c|}
		\hline
		& Sep. 2023 & Nov. 2023 & Mar. 2024 & Elección Junio 2024 \\
		\hline
		Sheinbaum & 53\% & 52\% & 52\% & 59.4 \% \\
		\hline
		Xóchitl & 34\% & 30\% & 33\% & 27.9 \% \\
		\hline
		Candidatura MC & 7\% & 10\% & 4\% & 10.4\% \\
		\hline
		Otros & 6\% & 8\% & 12\% & 2.3\% \\
		\hline
	\end{tabular}
	\label{tab:datos_crudos}
	\caption{Datos originales de las encuestas realizadas por el grupo GEA-ISA y resultados finales en las elecciones.}
\end{table}
	
	Para iniciar la experimentación con el caso más sencillo, se tomaron en cuenta únicamente a los dos candidatos principales en la elección estudiada. De esta forma, se ajustaron los porcentajes de las encuestas de opinión y los resultados de la elección, eliminando a las opciones correspondientes a MC y otros. 
	
	Después de este proceso de ajuste, se tienen los datos referenciados en el cuadro \ref{tab:datos_reales}, tomando como punto de inicio la fecha de la primera encuesta y como final el día de la elección. El candidato A se corresponde  Claudia Sheinbaum en la elección estudiada, y el candidato B a Xóchitl Gálvez. Ambas opciones suman al 100\% de las preferencias después de los ajustes realizados. Un trabajo futuro a realizar es la experimentación con el total de las tres opciones en un modelo más robusto.
	
\begin{table}[h]
	\centering
	\begin{tabular}{|c|c|c|c|}
		\hline
		\textbf{Fecha} & 
		\textbf{Tiempo (días)} & 
		\textbf{Preferencia por A (\%)} & 
		\textbf{Preferencia por B (\%)} 
		\\
		\hline
		2023/09/16 &
		0  &
		39  & 
		61
		\\ 
		\hline
		2023/11/25 &
		70  &
		64  &
		36
		\\
		\hline 
		2024/03/01 &
		167  &
		61 &
		39 \\
		\hline 
		2024/06/02 &
		260  &
		68 &
		32 \\
		\hline
	\end{tabular}
	\label{tab:datos_reales}
	\caption{Datos ajustados a solamente dos opciones en la elección estudiada.}
\end{table}
	
	Los modelos se comparan en base a qué tanto se aproximan a los porcentajes de preferencia en los días considerados, además de qué tanto logran aproximar los resultados finales de la elección. Esto se evalúa mediante el uso del error cuadrático medio (MSE) y la raíz de este (RMSE) sobre los 3 puntos a considerar con respecto al porcentaje de votos obtenido por cada partido, dado que todas las corridas del modelo inician con los porcentajes dados por las encuestas en el día 0. Para ello se utilizan las fórmulas siguientes.
	
	\begin{equation*}
		\begin{split}
			MSE &= \frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2| 
			\\
			RMSE &= \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2}
		\end{split}
	\end{equation*}	
	
	Para su uso en este trabajo, se adaptó de la manera siguiente
	\begin{equation*}
		RMSE = \sqrt{\frac{1}{|T|} \sum_{t \in T} \frac{1}{2} \sum_{p \in \{A, B\}} (P_{t,p} - \hat{P}_{t,p})^2}
	\end{equation*}
	donde:
	\begin{itemize}
		\item $T$ indica el total de días con datos reales, tres en este caso.
		\item $P_{t,p}$ es el porcentaje de preferencia real para el partido $p$ en el tiempo $t$.
		\item $\hat{P}_{t,p}$ es el porcentaje de preferencia obtenido por la simulación para el partido $p$ en el tiempo $t$.
	\end{itemize}
	
	Así, el error se mide para ambos partidos por cada uno de los tres días considerados. 
\section{Experimentación}
\subsection{Modelo de influencia positiva}

Se iniciaron los experimentos tomando el modelo de influencia más sencillo considerado en este trabajo. Después de cada interacción, los agentes siempre tendrán una opinión más parecida. Cada paso de tiempo en el modelo indica un día, llegando al total de 260 considerados dentro de la elección a simular. 

Para este tipo de influencia se consideran tres parámetros: \textit{learning rate}, indicando el grado en que un agente cambia de opinión después de una interacción, el parámetro \textit{agents per tick} que indica el número de agentes seleccionados para interactuar en cada paso de tiempo, y finalmente el parámetro \textit{spatial interactions} que controla si los agentes interactúan con todos aquellos presentes en la simulación o únicamente con sus vecinos inmediatos. El efecto de estos parámetros sobre la distribución final de opiniones y preferencia de votos se evalúa mediante los experimentos listados a continuación. 

Algo a destacar es que dado el funcionamiento del modelo, después de cada interacción al menos dos agentes diferentes cambiarán su opinión. Dado que nada en el modelo impida que se repitan los agentes seleccionados inicialmente, se observa que en cada paso cambian de opinión a lo más $2 \times \text{agents per tick}$ agentes.

\subsubsection{Experimento 1. Variación del parámetro \textit{learning rate}}
En el primer experimento se evalúa cómo la variación del parámetro \textit{learning rate} afecta la evolución de la opinión en el tiempo, y si existen valores específicos para este parámetro capaces de reproducir el cambio de opinión observado en el caso de estudio. Se fijo el número de agentes por tick en 1, y se desactivaron las interacciones espaciales. De esta manera, dos agentes cambian de opinión en cada paso de tiempo.

Mediante el uso de la herramienta \textit{Behaviorspace}, se realizaron variaciones del parámetro desde el valor 0 hasta 1, con pasos de 0.01. Se realizaron 30 repeticiones con el modelo para cada uno de estos parámetros con el objetivo de obtener validez estadística. Las variables de interés son \textit{pref-A} y \textit{pref-B} en los ticks correspondientes a los días de encuesta y la elección final para evaluar el error obtenido por el modelo. La configuración para este experimento se puede observar en el cuadro \ref{tab:experimento1_setup}.

\begin{table}[h!]
	\centering
\begin{tabular}{|c|c|}
	\hline
	\textbf{Parámetro} & \textbf{Valor} \\
	\hline
	\textit{learning-rate} & Entre $[0,1]$ con saltos de $0.01$. \\
	\hline
	\textit{influence-type} & \textit{positive}  \\
	\hline
	\textit{confidence-threshold} & No aplica \\
	\hline
	\textit{percent-option-B} & 39 \\
	\hline
	\textit{agents-updated-per-tick} & 1 \\
	\hline
	\textit{spatial-interactions?} & \textit{False} \\
	\hline
\end{tabular}
	\label{tab:experimento1_setup}
	\caption{Configuración para experimento 1 con influencia positiva.}
\end{table}

\subsubsection{Resultados}
Para cada uno de los 100 valores dados al parámetro \textit{learning rate}, se tomó el promedio de las 30 repeticiones para obtener los valores de referencia para \textit{pref-A} y \textit{pref-B} en cada tick de la simulación. Estos fueron los valores utilizados para medir el error con respecto a los datos reales de la elección, siendo visualizados en la figura \ref{fig:exp1_lr_vs_rmse}.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{figs/exp1_lr_vs_rmse}
	\caption{Error del modelo con respecto a los datos reales de acuerdo al valor dado al parámetro learning rate.}
	\label{fig:exp1_lr_vs_rmse}
\end{figure}

De acuerdo al error calculado, se observa el mejor desempeño con el parámetro $\textit{learning rate} = 0.53$. Los 5 valores con menor valor para el error se listan en la tabla \ref{tab:exp1_resultados}. En la figura \ref{fig:exp1_prefA} se observa la evolución de las opiniones obtenidas mediante el modelo bajo este parámetro comparadas con los datos reales obtenidos de las encuestas. 

\begin{table}[h!]
	\centering
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{learning rate} 
		&
		\textbf{MSE} 
		& 
		\textbf{RMSE}  
		\\
		\hline
		0.53	& 16.8 & 4.10 \\
		\hline
		0.39 & 16.8 & 4.10 \\
		\hline
		0.65 & 16.9 & 4.11 \\
		\hline
		0.42 & 17.1 & 4.13 \\
		\hline
		0.46 & 17.3 & 4.16 \\ 
		\hline
	\end{tabular}
	\label{tab:exp1_resultados}
	\caption{Mejores resultados obtenidos al variar el número de agentes interactuando por tick.}
\end{table}

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{figs/exp1_bestfit_prefA}
	\caption{Evolución de preferencias por la opción A con learning rate = 0.53. Los diamantes indican las preferencias reales reportadas por las encuestas y los resultados de la elección.}
	\label{fig:exp1_prefA}
\end{figure}

%\begin{figure}[h!]
%	\centering
%	\includegraphics[width=0.7\linewidth]{figs/exp1_bestfit_prefB}
%	\caption{Evolución de preferencias por la opción B con learning rate = 0.53. Los diamantes indican las preferencias reales reportadas por las encuestas y los resultados de la elección.}
%	\label{fig:exp1_prefB}
%\end{figure}

Se observa una alta variabilidad en el error del modelo, con una tendencia a la baja alrededor del valor de $0.5$ para el parámetro evaluado. Para el valor obtenido con el menor error posible, no logra acercarse al porcentaje de votos obtenido en la elección ni al cambio de opinión registrado en la segunda encuesta. Sin embargo, se observa que logra mantenerse cerca de los resultados de la tercera encuesta de opinión.

Esto es de esperarse, dado que únicamente se actualiza la opinión de dos agentes por tick. Dado el cambio brusco entre la última encuesta y los resultados obtenidos en la elección real, se necesita un modelo en el que una parte significativa de la población logré cambiar de opinión en el tiempo delimitado. El valor obtenido para \textit{learning rate} indica un cambio rápido de opinión después de cada interacción, pero esto no es suficiente para contrarrestar el bajo número de interacciones por tick. 

Para evaluar esto, se realiza un segundo experimento para explorar el efecto de diferentes valores del parámetro \textit{agents-updated-per-tick} en el desempeño del modelo.

\clearpage

\subsubsection{Experimento 2. Variación del parámetro \textit{agents-updated-per-tick}.}

Para el segundo experimento se analizó el efecto del parámetro \textit{agents-updated-per-tick} en el cambio de opinión. En el modelo, esto representa el número de personas que seleccionan a otra para compartir su opinión en un día, con un mínimo de 1 y máximo de 1070. Después de cada interacción, ambos agentes cambian el valor de su opinión. Utilizando \textit{Behaviorspace}, se evaluó este parámetros para valores en el rango $[2, 1070]$, con saltos de uno y 30 repeticiones por cada valor. El parámetro \textit{learning rate} se mantuvo fijo en $0.53$, dado que este obtuvo el mejor resultado en el experimento anterior. La configuración se muestra en el cuadro \ref{tab:experimento2_setup}. 

\begin{table}[h!]
	\centering
	\begin{tabular}{|c|c|}
		\hline
		\textbf{Parámetro} & \textbf{Valor} \\
		\hline
		\textit{learning-rate} & $0.53$ \\
		\hline
		\textit{influence-type} & \textit{positive}  \\
		\hline
		\textit{confidence-threshold} & No aplica \\
		\hline
		percent-option-B & 39 \\
		\hline
		\textit{agents-updated-per-tick} & Entre $[2, 1070]$ con saltos de 1. \\
		\hline
		\textit{spatial-interactions?} & \textit{False} \\
		\hline
	\end{tabular}
	\label{tab:experimento2_setup}
	\caption{Configuración para el segundo experimento con influencia positiva.}
\end{table}

\subsubsection{Resultados}

En las figuras \ref{fig:exp2_error_1070}, \ref{fig:exp2_error_10} se muestran los errores obtenidos para los 1070 valores evaluados y para los primeros 10, respectivamente. Se observa que el mejor resultado para el parámetro estudiado se obtuvo cuando este es igual a 5.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{figs/exp2_error_1070}
	\caption{Error obtenido al variar el número de interacciones por día. Se observa un aumento muy rápido del error conforme aumenta el valor, con una ligera caída alrededor del valor de 5.}
	\label{fig:exp2_error_1070}
\end{figure}

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{figs/exp2_error_10}
	\caption{Acercamiento al error para los primeros 10 valores tomados por el parámetro. El valor mínimo para el error se obtiene con 5 interacciones por día.}
	\label{fig:exp2_error_10}
\end{figure}

Para el parámetro evaluado, se obtuvieron los mejores resultados con los valores indicados en la tabla \ref{tab:resultados_exp2}

\begin{table}[h!]
	\centering
	\begin{tabular}{|c|c|c|}
		\hline
	\textbf{Agentes por tick} 
	&
	\textbf{MSE} 
	 & 
	\textbf{RMSE}  
	\\
	\hline
		5	& 4.64 & 2.15 \\
		\hline
		6 & 6.34 & 2.54 \\
		\hline
		4 & 6.46 & 2.54 \\
		\hline
		3 & 9.01 & 3.00 \\
		\hline
		7 & 11.5 & 3.39\\ 
		\hline
	\end{tabular}
	\label{tab:resultados_exp2}
	\caption{Mejores resultados obtenidos al variar el número de agentes interactuando por tick.}
\end{table}

En la figura \ref{fig:exp2_pref_A} se observa el cambio de opiniones obtenidos por el modelo al tomar el parámetro \textit{learning rate} $ = 0.5$ del experimento anterior junto a 5 agentes interactuando por día. 

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{figs/exp2_pref_A}
	\caption{Evolución de prefencias por A en el modelo básico de influencia positiva con 5 agentes interactuando por día.}
	\label{fig:exp2_pref_A}
\end{figure}

%\begin{figure}[h!]
%	\centering
%	\includegraphics[width=0.7\linewidth]{figs/exp2_pref_B}
%	\caption{Evolución de prefencias por B en el modelo básico de influencia positiva con 5 agentes interactuando por día.}
%	\label{fig:exp2_pref_B}
%\end{figure}

Se observa un mejor ajuste del modelo comparado con los datos reales, obteniendo un mayor acercamiento a los resultados finales de la elección y a los puntos considerados en las encuestas de opinión. Sin embargo, se sigue observando una alta variabilidad del modelo, con un margen muy amplio que aumenta con cada día. Bajo estos parámetros, en el modelo se tiene a los más 10 agentes cambiando de opinión al día, lo que se corresponde a un $0.9 \%$ de la población total. El valor alto del parámetro \textit{learning rate} indica un alto cambio en la opinión después de cada interacción, y la inicialización del modelo con una preferencia clara por la opción A lleva a que se tenga una tendencia al consenso respecto a esta opción, siguiendo la evolución observada en la elección real.

Queda evaluar la relación entre el parámetro de número de agentes fijo en $5$ junto con otros valores para el \textit{learning rate}, evaluando si existe algún valor diferente para este parámetro que dé resultados significativamente mejores.

\clearpage

\subsubsection{Experimento 3. Valuación del parámetro \textit{learning rate} con número de agentes interactuando fijo.} 
 
Para este experimento, se busca comparar si existe un cambio significativo en el modelo al fijar el número de agentes en 5 y cambiar el valor del parámetro \textit{learning rate}, dado que se observo que este número de agentes seleccionados para interactuar por tick dio las mejores aproximaciones al problema. Se debe mencionar que al seleccionar 5 agentes por tick, se tiene un máximo de 10 agentes cambiando su opinión por día, y un mínimo de 2. Mediante el uso de la herramienta \textit{Behaviorspace}, el valor del parámetro \textit{learning rate} se mueve entre el rango $[0,1]$, con saltos de $0.01$. Se realizan 30 repeticiones para cada uno de estos valores, con el número de agentes fijo en 5 y sin activar las interacciones espaciales. La configuración completa su muestra en el cuadro \ref{tab:exp3_setup}.


 \begin{table}[h!]
 	\centering
 	\begin{tabular}{|c|c|}
 		\hline
 		\textbf{Parámetro} & \textbf{Valor} \\
 		\hline
 		\textit{learning-rate} & Entre $[0, 1]$ con saltos de $0.01$ \\
 		\hline
 		\textit{influence-type} & \textit{positive}  \\
 		\hline
 		\textit{confidence-threshold} & No aplica \\
 		\hline
 		\textit{percent-option-B} & 39 \\
 		\hline
 		\textit{agents-updated-per-tick} & 5 \\
 		\hline
 		\textit{spatial-interactions?} & \textit{False} \\
 		\hline
 	\end{tabular}
 	\label{tab:exp3_setup}
 	\caption{Configuración para el segundo experimento con influencia positiva.}
 \end{table}
 
 \subsubsection{Resultados}
 
 Para el cálculo del error se toma como referencia al promedio de las 30 repeticiones por cada parámetro. Se compara el porcentaje de preferencia por A y por B obtenido con el modelo con aquel reportado en los datos reales, y se evalúa el error cuadrático medio. Los resultados se pueden observar en la figura \ref{fig:exp3error}, y en el cuadro \ref{tab:resultados_exp3} se muestran los valores del parámetro que obtuvieron el menor error. 
 
 \begin{figure}[h!]
 	\centering
 	\includegraphics[width=0.7\linewidth]{figs/exp3_error}
 	\caption{Cambio en el error al mantener el número de agentes seleccionados para interactuar fijo en 5 y variar el valor del parámetro \textit{learning rate}. Se corresponde con los resultados del primer experimento, con una menor variabilidad.}
 	\label{fig:exp3error}
 \end{figure}
 
 \begin{table}[h!]
 	\centering
 	\begin{tabular}{|c|c|c|}
 		\hline
 		\textbf{\textit{Learning rate}} 
 		&
 		\textbf{MSE} 
 		& 
 		\textbf{RMSE}  
 		\\
 		\hline
 		0.58 & 4.22 & 2.06 \\
 		\hline
 		0.44 & 4.32 & 2.08 \\
 		\hline
 		0.57 & 4.49 & 2.12 \\
 		\hline
 		0.61 & 4.70 & 2.17 \\
 		\hline
 		0.43 & 4.71 & 2.17\\ 
 		\hline
 	\end{tabular}
 	\label{tab:resultados_exp3}
 	\caption{Mejores resultados obtenidos al variar el parámetro \textit{learning rate}, manteniendo fijo el número de agentes seleccionados para interactuar inicialmente en 5.}
 \end{table}
 
 Seleccionando el valor del parámetro con el menor error, \textit{learning rate} $= 0.58$, se realizan 30 simulaciones para comparar la evolución de las opiniones generadas por el modelo con estas características con los datos reales. La evolución de las preferencias por el candidato A se pueden visualizar en la figura \ref{fig:exp3_pref_A}.
 
 \begin{figure}[h!]
 	\centering
 	\includegraphics[width=0.7\linewidth]{figs/exp3_pref_A}
 	\caption{Evolución de prefencias por A en el modelo básico de influencia positiva con 5 agentes interactuando por día y valor de \textit{learning rate} fijo en 0.58.}
 	\label{fig:exp3_pref_A}
 \end{figure}
 
 Comparando el mejor resultado obtenido en este experimento con el anterior, se observa una disminución del error. Sin embargo, dada la alta variabilidad de los resultados, se deben llevar a cabo pruebas estadísticas para validar que esta configuración para el modelo de resultados significativamente mejores de forma constante. Algo que sí se puede evaluar es que el parámetro \textit{learning rate} da los mejores resultados con valores dentro del rango $[0.4, 0.6]$, algo que se observó desde el primer experimento pero con una mayor variabilidad.
 
 En su configuración actual, el modelo reproduce un contexto en el cual cada día 5 personas eligen a alguien para compartir su opinión, y al intercambiarla ambos intentan llegar a un punto intermedio. Este cambio es brusco, dado el valor obtenido por el parámetro \textit{learning rate}, y lleva a aumentar la preferencia por la opción A, que lleva ventaja desde el inicio de la simulación 
 
 A pesar de que un modelo tan básico logré reproducir con un error bajo el cambio de opinión registrado en las encuestas, queda por explorar su capacidad de reproducir patrones secundarios en la distribución del voto. 
 
 En la sección siguiente, se lleva a cabo la evaluación del desempeño del modelo de influencia negativa, donde los agentes toman opiniones más extremas si interactúan con alguien con una opinión discorde.
 
\clearpage

\subsection{Modelo de influencia negativa}

Bajo la influencia negativa, los dos agentes involucrados en una interacción toman una opinión más extrema si la diferencia entre sus opiniones es mayor a un valor dado, definido en el modelo por el parámetro \textit{confidence threshold}. Dado que las opiniones en el modelo toman valores entre $[-1, 1]$, la diferencia máxima entre dos opiniones es $2$. Un valor menor a $1$ para \textit{confidence threshold} suele llevar a polarización, y un valor mayor para este parámetro suele llevar a consenso. 

En los experimentos para este tipo de influencia se evalúa la interacción de este parámetro junto con los otros presentes en el modelo, ya estudiados en la sección anterior: número de agentes interactuando por tick, \textit{learning rate} y la interacción espacial.

\subsubsection{Experimento 1. Valoración del efecto del parámetro \textit{learning rate.}}

Se inicia valorando el efecto del parámetro \textit{learning rate} en las simulaciones. Este controla la velocidad con la que los agentes ajustan su opinión después de una interacción, siendo más rápida mientras mayor sea el valor. Para la configuración se elige un total de 5 agentes por tick, dado que se observó en los resultados anteriores que un valor menor a este lleva a resultados pobres. Se toma un valor de \textit{confidence threshold} igual a 1, implicando que el efecto repulsivo de la influencia negativa se da en alrededor del 50\% de las interacciones observadas en el modelo. La configuración para todos los parámetros se lista en el cuadro \ref{label}. Como en el resto de experimentos, se realizan 30 repeticiones por cada combinación de parámetros mediante el uso de \textit{Behaviorspace} en NetLogo.

 \begin{table}[h!]
	\centering
	\begin{tabular}{|c|c|}
		\hline
		\textbf{Parámetro} & \textbf{Valor} \\
		\hline
		\textit{learning-rate} & Entre $[0, 1]$ con saltos de $0.01$ \\
		\hline
		\textit{influence-type} & \textit{negative}  \\
		\hline
		\textit{confidence-threshold} & 1 \\
		\hline
		percent-option-B & 39 \\
		\hline
		\textit{agents-updated-per-tick} & 5 \\
		\hline
		\textit{spatial-interactions?} & \textit{False} \\
		\hline
	\end{tabular}
	\label{tab:exp1_negativa_setup}
	\caption{Configuración para el primer experimento con influencia negativa.}
\end{table}

\subsubsection{Resultados}
Se toma el promedio de las 30 repeticiones para cada combinación de parámetros como referencia, y se utiliza para medir el error comparado con los datos reales. El error para las 100 combinaciones de valores se gráfica en la figura \ref{fig:negativaexp1error}, y los 5 parámetros con mejores resultados se listan en el cuadro \ref{tab:negativa_exp1_resultados}.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{figs/negativa_exp1_error}
	\caption{Gráfica del error para el modelo de influencia negativa variando el parámetro learning rate con la configuración indicada. Se observa una alta variabilidad, pero con una tendencia a la baja en valores alrededor de 0.5.}
	\label{fig:negativaexp1error}
\end{figure}


\begin{table}[h!]
	\centering
	\begin{tabular}{|r|r|r|}
		\hline
		\textit{learning rate} & MSE & RMSE\\
		\hline
		0.42 & 7.78 & 2.79\\
		\hline
		0.59 & 8.06 & 2.84\\
		\hline
		0.48 & 8.26 & 2.87\\
		\hline
		0.50 & 8.49 & 2.91\\
		\hline
		0.43 & 8.78 & 2.96\\
		\hline
	\end{tabular}	
	\caption{Valores para \textit{learning rate} con el menor error bajo la configuración estudiada.}
	\label{tab:negativa_exp1_resultados}
\end{table}

Se realizan 30 simulaciones tomando la combinación de parámetros con los mejores resultados, siendo esta tomando un valor de 0.42 para \textit{learning rate}. La visualización del cambio de preferencia por la opción A se muestra en la figura \ref{fig:negativaexp1best}.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{figs/negativa_exp1_best}
	\caption{Evolución de preferencias para 30 repeticiones de la mejor combinación de parámetros. Se observa una alta variabilidad, y un fallo al momento de acercarse a los resultados finales de la elección.}
	\label{fig:negativaexp1best}
\end{figure}

En base a los resultados obtenidos, se observa un desempeño peor al obtenido con el mejor modelo de influencia positiva, sobre todo al momento de aproximar los resultados finales de la elección. Esto se debe a que se tiene una preferencia por A muy baja, lo que indica que puede necesitarse un mayor número de agentes interactuando por día. Esto será evaluado en el próximo experimento. Algo a destacar es que para el parámetro \textit{learning rate} el error se minimiza con valores alrededor de $0.5$, de manera similar al modelo de influencia positiva. Esto da pistas de que el valor óptimo para este parámetro no es afectado por el tipo de influencia simulado. Cabe mencionar que un valor alto indica un cambio de opinión rápido, lo que da indicios de una población susceptible. Sin embargo, de momento no se ha tenido en cuenta las características de cada agente para elegir con quién interactuar cada paso de tiempo.


\subsubsection{Experimento 2. Efectos del parámetro \textit{agents updated per tick} en el modelo de influencia negativa}

Para la siguiente validación del modelo se explorar el efecto del número de agentes interactuando por tick. Para ello, se toma como referencia el valor de \textit{learning rate} con mejores resultados  en el experimento anterior, y con la misma configuración en las variables. Dado que en experimentos anteriores se ha comprobado que valores altos para el número de agentes interactuando dan malos resultados, se limita a explorar los valores en el rango $[1, 100]$ con saltos de 1. Para cada valor se realizan 30 repeticiones. El listado completo de la configuración para este experimento se tiene en \ref{label}.

 \begin{table}[h!]
	\centering
	\begin{tabular}{|c|c|}
		\hline
		\textbf{Parámetro} & \textbf{Valor} \\
		\hline
		\textit{learning-rate} & 0.42 \\
		\hline
		\textit{influence-type} & \textit{negative}  \\
		\hline
		\textit{confidence-threshold} & 1 \\
		\hline
		\textit{percent-option-B} & 39 \\
		\hline
		\textit{agents-updated-per-tick} & Entre $[1, 100]$ con saltos de 1. \\
		\hline
		\textit{spatial-interactions?} & \textit{False} \\
		\hline
	\end{tabular}
	\label{tab:exp2_negativa_setup}
	\caption{Configuración para el segundo experimento con influencia negativa.}
\end{table}

\subsubsection{Resultados}
El desempeño del modelo se evalúa de acuerdo a las preferencias obtenidas en la simulación. Para ello, se toma el promedio de las 30 repeticiones por cada valor del parámetro estudiado y se compara con los datos reales de las encuestas. En la figura \ref{} se muestra el cambio del error con respecto al valor dado al parámetro \textit{agents updated per tick}. En el cuadro \ref{label} se muestran los parámetros con  el mejor desempeño.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{figs/negativa_exp2_error}
	\caption{Error para el modelo de acuerdo a la variación del número de agentes interactuando por tick. Se observa el menor error con valores alrededor de 10, aumentando rápidamente para valores mayores.}
	\label{fig:negativaexp2error}
\end{figure}


\begin{table}[h!]
	\centering
	\begin{tabular}{|r|r|r|}
		\hline
		\textit{agents per tick} & MSE & RMSE\\
		\hline
		8 & 4.62 & 2.15\\
		\hline
		7 & 5.32 & 2.31\\
		\hline
		9 & 6.83 & 2.61\\
		\hline
		6 & 6.98 & 2.64\\
		\hline
		10 & 7.83 & 2.80\\
		\hline
	\end{tabular}
	\label{fig:negativa_exp2_error}
	\caption{Mejores resultados para el parámetro \textit{agents per tick}. Se observa que los valores listados se encuentran entre 6 y 10, ligeramente mayores al modelo de influencia positiva.}
\end{table}

Se realizan 30 simulaciones del modelo con la configuración inicial y el parámetro \textit{agents per tick} con valor igual a 8. Se compara la evolución de las preferencias en el modelo con los datos de la encuesta real, y el resultado se muestra en la figura \ref{fig:negativaexp2best}.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{figs/negativa_exp2_best}
	\caption{Evolución de las opiniones para el mejor parámetro encontrado en el experimento. Se observa una aproximación con alta variabilidad y menos exactitud que en el modelo de influencia positiva.}
	\label{fig:negativaexp2best}
\end{figure}

Se observa una mejora en los resultados con respecto al experimento anterior, con un mejor acercamiento a los resultados finales de la elección. Sin embargo, no se tienen un desempeño significativamente mejor que en el modelo de influencia positiva. Algo a destacar es que los mejores resultados en este modelo se dieron con un número de agentes ligeramente mayor que en la influencia positiva, lo que indica que se necesita un mayor número de agentes cambiando de opinión en cada tick para aproximar la evolución de opiniones observada en la realidad. 

Esto se debe al efecto repulsivo controlado por el parámetro \textit{confidence threshold}. Si este toma un valor bajo, el efecto repulsivo sobre las opiniones será mayor, mientras que se reduce para valores más grandes. Dado que se observa una tendencia al consenso con respecto a la opción A, se espera obtener mejores resultados al aumentar el valor de este parámetro. Para explorar esto se realiza otro experimento.

\subsubsection{Experimento 3. Efecto del parámetro \textit{confidence threshold} en el modelo de influencia negativa.}

Para finalizar la evaluación del modelo de influencia negativa, se explora el efecto del parámetro \textit{confidence treshold} sobre la evolución de las preferencias. En base a los experimentos anteriores se identifico el mejor desempeño con 8 agentes seleccionados para interactuar en cada paso de tiempo, con un valor de \textit{learning rate} de 0.42. El primer parámetro indica el número de agentes cambiando de opinión en cada día, mientras que el segundo controla la velocidad del cambio de opinión. 

El parámetro evaluado en este experimento controla la facilidad con la que se dispara el efecto repulsivo del modelo de influencia negativa. Mientras menor sea el valor de este parámetro aumenta la probabilidad del efecto negativo, con un valor de 1 teniendo una probabilidad de activarlo en el 50\% de las interacciones. Para valores mayores esta probabilidad disminuye, llegando a ser muy cercano a cero para un valor de 2. Este parámetro se explorará con valores entre $[0,2]$ con saltos de $0.1$, y 30 repeticiones para cada valor del parámetro. La configuración completa del experimento se muestra en \ref{label}.

 \begin{table}[h!]
	\centering
	\begin{tabular}{|c|c|}
		\hline
		\textbf{Parámetro} & \textbf{Valor} \\
		\hline
		\textit{learning-rate} & 0.42 \\
		\hline
		\textit{influence-type} & \textit{negative}  \\
		\hline
		\textit{confidence-threshold} & 1 \\
		\hline
		percent-option-B & 39 \\
		\hline
		\textit{agents-updated-per-tick} & Entre $[1, 100]$ con saltos de 1. \\
		\hline
		\textit{spatial-interactions?} & \textit{False} \\
		\hline
	\end{tabular}
	\label{tab:exp3_negativa_setup}
	\caption{Configuración para el tercer experimento con influencia negativa.}
\end{table}

\subsubsection{Resultados.}

Se toma el promedio de las 30 repeticiones para cada valor del parámetro como referencia para evaluar el error del modelo con respecto a los datos reales. En base a ello, en la figura \ref{fig:negativaexp3error} se muestra el error con respecto a cada uno de los 20 parámetros evaluados. Se observa cómo este disminuye al aumentar el valor, con un mínimo alrededor de 1.5, listándose los valores con el mejor desempeño en el cuadro \ref{tab:negativa_exp3_resultados}.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{figs/negativa_exp3_error}
	\caption{Error para el modelo de influencia negativa de acuerdo al valor del parámetro confidence threshold. Se observa como este se minimiza con valores alrededor de 1, aumentando en los extremos.}
	\label{fig:negativaexp3error}
\end{figure}

\begin{table}[h!]
	\centering
	\begin{tabular}{|r|r|r|}
		\hline
		\textit{confidence threshold} & MSE & RMSE\\
		\hline
		1.0 & 5.07 & 2.25\\
		\hline
		0.9 & 5.97 & 2.44\\
		\hline
		1.1 & 6.61 & 2.57\\
		\hline
		1.2 & 6.68 & 2.59\\
		\hline
		1.3 & 9.98 & 3.16\\
		\hline
	\end{tabular}
	\label{tab:negativa_exp3_resultados}
	\caption{Mejores resultados para la variación del parámetro \textit{confidence threshold} en el modelo de influencia negativa.}
\end{table}

Se tiene que el error se minimizó para el parámetro con valor igual a 1, dando el mismo modelo que en el experimento anterior. Por lo tanto, se omite la visualización de la evolución de las opiniones. Con esto se concluye que el modelo presenta los mejores resultados al tener una posibilidad intermedia de activar el efecto repulsivo, aumentando el error al llegar a los extremos.

Esto se observa en las simulaciones, con valores bajos llevando a una polarización temprana en las opiniones, lo que conlleva un aumento de votos para la opción B que no se corresponde con los observado en la realidad. Por otro lado, valores altos para el parámetro llevan a un consenso prematuro, de forma que la opción A domina los votos de una forma prematura. El valor de 1 para este parámetro lleva a un punto intermedio entre ambos fenómenos.

Con base a lo observado, el desempeño del modelo no es significativamente mejor al del confianza positiva, llegando a obtener valores ligeramente más altos para el error. Por tanto, queda explorar el modelo de confianza acotada como alternativa para la simulación de la elección.

\subsection{Modelo de confianza acotada}
El modelo de confianza acotada toma como suposición principal que la opinión se ve afectada únicamente al interactuar con otras personas que tengan una opinión parecida a la propia. En caso contrario, no se altera la opinión de ninguno de los agentes. Esto se diferencia del modelo de influencia negativa, donde una opinión muy disimilar causa un efecto repulsivo en los agentes. En la literatura, el modelo de confianza acotada es conocido por llevar a la agrupación de opiniones, donde estas se concentran en diferentes grupos a lo largo del rango de valores para la opinión.

En el modelo desarrollado se tiene el parámetro \textit{confidence threshold} guiando la diferencia de opiniones máxima antes de que no se logre influenciar al otro agente. De esta forma, un valor pequeño indica que solo un agente solo se verá afectado por opiniones cercanas, y conforme el valor de este parámetro aumenta los agentes se ven afectados por opiniones más disimilares. Esto se puede utilizar para evaluar la influenciabilidad o "open mindness" de la población estudiada.

Nuevamente se realizan experimentos para evaluar el efecto de los siguientes parámetros en la evolución de las preferencias: \textit{learning rate}, \textit{agents per tick} y \textit{confidence treshold}. Se toma en cuenta los resultados de los experimentos anteriores para limitar la búsqueda de parámetros.

\subsubsection{Experimento 1. Efecto de \textit{learning rate} en el modelo de confianza acotada}

Como en el resto de modelos considerados en el estudio, el parámetro \textit{learning rate} gobierna la velocidad con la que los agentes del modelo cambian su opinión después de una interacción. Tomando en consideración los experimentos anteriores, se fija el número de agentes por tick en 5, considerando que en ambos modelos anteriores los mejores resultados se obtuvieron para valores alrededor de este. El parámetro \textit{confidence treshold} se fija en 1, un punto intermedio entre los extremos. De acuerdo a la diversidad de opiniones en el modelo, esto limita el número de agentes que actualizan su opinión por paso de tiempo, de forma independiente al número de agentes por tick. Se realizan 30 simulaciones por cada configuración de los parámetros, con los valores mostrados en el cuadro \ref{tab:exp1_BC_setup}. El parámetro \textit{learning rate} se exploró para valores entre $[0, 1]$ con saltos de $0.01$.

 \begin{table}[h!]
	\centering
	\begin{tabular}{|c|c|}
		\hline
		\textbf{Parámetro} & \textbf{Valor} \\
		\hline
		\textit{learning-rate} & Entre $[0, 1]$ con saltos de $0.01$ \\
		\hline
		\textit{influence-type} & \textit{BC}  \\
		\hline
		\textit{confidence-threshold} & 1 \\
		\hline
		percent-option-B & 39 \\
		\hline
		\textit{agents-updated-per-tick} & 5 \\
		\hline
		\textit{spatial-interactions?} & \textit{False} \\
		\hline
	\end{tabular}
	\label{tab:exp1_BC_setup}
	\caption{Configuración para el primer experimento con confianza acotada.}
\end{table}

 % ----- Protocolo ODD para evaluar el modelo ----- 

\include{odd_base_new.tex}

\bibliography{bibliografia.bib}
\end{document}